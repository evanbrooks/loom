<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Springs</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <style>
      .spring-graph {
        height: 50px;
      }
      
      #cat {
        color: rgba(0,128,0,1);
      }
      
      path {
        fill: transparent;
        stroke: rgba(0,0,255,1);
        stroke-width: 1px;
      }
      line {
        stroke: rgba(128,128,128,1);
        stroke-width: 0.2px;
      }
      label {
        display: block;
      }
      input[type=range] {
        width: 800px;
      }
    </style>
  </head>
  
	<body>

    <div class="springmaker">
      <div>
        <svg class="spring-graph" id="graph"></svg>
      </div>


      <div>
        <label>
          <input data-spring="tension" type="range" min="0" max="2000" value="500">
          Tension
        </label>
        <label>
          <input data-spring="friction" type="range" min="0" max="100" value="10" step="0.01">
          Friction
        </label>
        <label>
          <input data-spring="velocity" type="range" min="-200" max="200" value="0">
          Velocity
        </label>
      </div>
    </div>

    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="rk4.js" type="text/javascript"></script>
    <script type="text/javascript">

      var opts = {
        tension: 500,
        friction: 10,
        velocity: 0
      }

      var sliders = document.querySelectorAll("[type=range]");
      for (var i = 0; i < sliders.length; i++) {
        sliders[i].addEventListener("input", slide);
      }
      function slide(e) {
        var id = this.getAttribute("data-spring");
        opts[id] = parseInt(this.value, 10);
        update();
      }

      var anim = new hackySpring();
      update();

      function update() {
        anim.setup(opts);

        var step = 0.01;
        var values = [0];
        var max = 1;
        var min = 0;
        var counter = 0;
        while (!anim.finished() && counter < 2000) {
          var val = anim.next(step);
          values.push(val);
          if (val < min) min = val;
          if (val > max) max = val;
          counter++;
        }

        draw(values);

        function draw(vals) {
          var distort = 2;
          var x = d3.scale.linear().domain([0, 1]).range([0, distort]),
              y = d3.scale.linear().domain([min,max]).range([49, 1]);

          var line = d3.svg.line()
              .x(function(d, i) { return x(i); })
              .y(function(d, i) { return y(d); });


          var svg = d3.select("#graph");

          var len = vals.length*distort;
          svg.attr("width", len);

          var axes = svg.selectAll(".start").data([vals[0], vals[vals.length-1]]);
          axes.enter()
            .append("line")
            .attr("class", "start")
          axes
            .attr("x1", 0  ).attr("y1", function(d, i) {  return y(d); })
            .attr("x2", len).attr("y2", function(d, i) {  return y(d); })


          var path = svg.selectAll("path").data([vals]);
          path.enter().append("path");
          path.attr("d", function(d) {  return line(d); });
        }
      }



    </script>
  </body>
</html>